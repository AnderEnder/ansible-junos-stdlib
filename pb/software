---
- name: Install Junos OS software
  hosts: all
  connection: local
  gather_facts: no
  vars:
    reboot_wait_time: 10
    restart_wait_time: 3600
    logfile: "{{ logdir }}/software.log"

  tasks:
    - name: Install Junos OS package
      junos_install_os:
        host={{ inventory_hostname }}
        user={{ admin_user }}
        package={{ packagedir }}/{{ package }}
        logfile={{ logfile }}
        no_copy=yes
        reboot=yes
      when: package is defined
      register: sw
      notify:
        - Junos reboot
        - Junos wait for restart

  handlers:
    - name: Junos reboot
      pause: seconds={{ reboot_wait_time }}
    - name: Junos wait for restart
      wait_for: host={{ inventory_hostname }} port=830 timeout={{ restart_wait_time }}
